define("taoThemingPlatform/controller/routes",[],function(){return{Main:{actions:{index:"controller/theming/main"}}}}),define("lib/farbtastic/farbtastic",["jquery"],function(jQuery){var $=jQuery;jQuery.fn.farbtastic=function(callback){return $.farbtastic(this,callback),this},jQuery.farbtastic=function(container,callback){if(container.length){var container=$(container).get(0);return container.farbtastic||(container.farbtastic=new jQuery._farbtastic(container,callback))}},jQuery._farbtastic=function(container,callback){var fb=this,e=$("<div>",{"class":"farbtastic"}),colorObj=$("<div>",{"class":"color"}),wheelObj=$("<div>",{"class":"wheel"}),overlayObj=$("<div>",{"class":"overlay"}),hMarkerObj=$("<div>",{"class":"h-marker marker"}),slMarkerObj=$("<div>",{"class":"sl-marker marker"});
container=$(container),$(e).append(colorObj),$(e).append(wheelObj),$(e).append(overlayObj),$(e).append(hMarkerObj),$(e).append(slMarkerObj),container.append(e),fb.wheel=wheelObj.get(0),fb.radius=70,fb.square=overlayObj.width(),fb.width=e.width(),fb.linkTo=function(callback){return"object"==typeof fb.callback&&$(fb.callback).unbind("keyup",fb.updateValue),fb.color=null,"function"==typeof callback?fb.callback=callback:("object"==typeof callback||"string"==typeof callback)&&(fb.callback=$(callback),fb.callback.bind("keyup",fb.updateValue),fb.callback.get(0).value&&fb.setColor(fb.callback.get(0).value)),this},fb.updateValue=function(){this.value&&this.value!=fb.color&&fb.setColor(this.value)
},fb.setColor=function(color){var unpack=fb.unpack(color);return fb.color!=color&&unpack&&(fb.color=color,fb.rgb=unpack,fb.hsl=fb.RGBToHSL(fb.rgb),fb.updateDisplay()),this},fb.setHSL=function(hsl){return fb.hsl=hsl,fb.rgb=fb.HSLToRGB(hsl),fb.color=fb.pack(fb.rgb),fb.updateDisplay(),this},fb.widgetCoords=function(event){var x,y,el=event.target||event.srcElement,reference=fb.wheel;if("undefined"!=typeof event.offsetX){for(var pos={x:event.offsetX,y:event.offsetY},e=el;e;)e.mouseX=pos.x,e.mouseY=pos.y,pos.x+=e.offsetLeft,pos.y+=e.offsetTop,e=e.offsetParent;for(var e=reference,offset={x:0,y:0};e;){if("undefined"!=typeof e.mouseX){x=e.mouseX-offset.x,y=e.mouseY-offset.y;
break}offset.x+=e.offsetLeft,offset.y+=e.offsetTop,e=e.offsetParent}for(e=el;e;)e.mouseX=void 0,e.mouseY=void 0,e=e.offsetParent}else{var pos=fb.absolutePosition(reference);x=(event.pageX||0*(event.clientX+$("html").get(0).scrollLeft))-pos.x,y=(event.pageY||0*(event.clientY+$("html").get(0).scrollTop))-pos.y}return{x:x-fb.width/2,y:y-fb.width/2}},fb.mousedown=function(event){document.dragging||($(document).bind("mousemove",fb.mousemove).bind("mouseup",fb.mouseup),document.dragging=!0);var pos=fb.widgetCoords(event);return fb.circleDrag=2*Math.max(Math.abs(pos.x),Math.abs(pos.y))>fb.square,fb.mousemove(event),!1},fb.mousemove=function(event){var pos=fb.widgetCoords(event);
if(fb.circleDrag){var hue=Math.atan2(pos.x,-pos.y)/6.28;0>hue&&(hue+=1),fb.setHSL([hue,fb.hsl[1],fb.hsl[2]])}else{var sat=Math.max(0,Math.min(1,-(pos.x/fb.square)+.5)),lum=Math.max(0,Math.min(1,-(pos.y/fb.square)+.5));fb.setHSL([fb.hsl[0],sat,lum])}return!1},fb.mouseup=function(){$(document).unbind("mousemove",fb.mousemove),$(document).unbind("mouseup",fb.mouseup),document.dragging=!1},fb.updateDisplay=function(){var angle=6.28*fb.hsl[0];$(".h-marker",e).css({left:Math.round(Math.sin(angle)*fb.radius+fb.width/2)+"px",top:Math.round(-Math.cos(angle)*fb.radius+fb.width/2)+"px"}),$(".sl-marker",e).css({left:Math.round(fb.square*(.5-fb.hsl[1])+fb.width/2)+"px",top:Math.round(fb.square*(.5-fb.hsl[2])+fb.width/2)+"px"}),$(".color",e).css("backgroundColor",fb.pack(fb.HSLToRGB([fb.hsl[0],1,.5]))),"object"==typeof fb.callback?($(fb.callback).css({backgroundColor:fb.color,color:fb.hsl[2]>.5?"#000":"#fff"}),$(fb.callback).each(function(){this.value&&this.value!=fb.color&&(this.value=fb.color)
})):"function"==typeof fb.callback&&fb.callback.call(fb,fb.color),container.trigger("colorchange.farbtastic",[fb.color])},fb.absolutePosition=function(el){var r={x:el.offsetLeft,y:el.offsetTop};if(el.offsetParent){var tmp=fb.absolutePosition(el.offsetParent);r.x+=tmp.x,r.y+=tmp.y}return r},fb.pack=function(rgb){var r=Math.round(255*rgb[0]),g=Math.round(255*rgb[1]),b=Math.round(255*rgb[2]);return"#"+(16>r?"0":"")+r.toString(16)+(16>g?"0":"")+g.toString(16)+(16>b?"0":"")+b.toString(16)},fb.unpack=function(color){return 7==color.length?[parseInt("0x"+color.substring(1,3))/255,parseInt("0x"+color.substring(3,5))/255,parseInt("0x"+color.substring(5,7))/255]:4==color.length?[parseInt("0x"+color.substring(1,2))/15,parseInt("0x"+color.substring(2,3))/15,parseInt("0x"+color.substring(3,4))/15]:void 0
},fb.HSLToRGB=function(hsl){var m1,m2,h=hsl[0],s=hsl[1],l=hsl[2];return m2=.5>=l?l*(s+1):l+s-l*s,m1=2*l-m2,[this.hueToRGB(m1,m2,h+.33333),this.hueToRGB(m1,m2,h),this.hueToRGB(m1,m2,h-.33333)]},fb.hueToRGB=function(m1,m2,h){return h=0>h?h+1:h>1?h-1:h,1>6*h?m1+(m2-m1)*h*6:1>2*h?m2:2>3*h?m1+(m2-m1)*(.66666-h)*6:m1},fb.RGBToHSL=function(rgb){var min,max,delta,h,s,l,r=rgb[0],g=rgb[1],b=rgb[2];return min=Math.min(r,Math.min(g,b)),max=Math.max(r,Math.max(g,b)),delta=max-min,l=(min+max)/2,s=0,l>0&&1>l&&(s=delta/(.5>l?2*l:2-2*l)),h=0,delta>0&&(max==r&&max!=g&&(h+=(g-b)/delta),max==g&&max!=b&&(h+=2+(b-r)/delta),max==b&&max!=r&&(h+=4+(r-g)/delta),h/=6),[h,s,l]},$("*",e).mousedown(fb.mousedown),fb.setColor("#123456"),callback&&fb.linkTo(callback)
}}),define("taoThemingPlatform/controller/theming/main",["jquery","helpers","lib/farbtastic/farbtastic","ui/feedback","ui/uploader"],function($,helpers,farbtastic,feedback){var theming={start:function(){var self=this,$scope=$(".platform-theme-selector"),$triggers=$scope.find(".customizer-trigger"),$popups=$scope.find(".customizer-popup"),cssObject={},logoObject={};self._initUploader(),self._initPopups($triggers,$popups,cssObject),$(".save").off("click").on("click",function(){self._initConfirmBox($popups,cssObject,logoObject)}),$(".file-uploader").on("upload.uploader",function(e,file,result){logoObject.logo=result,$.ajax({url:helpers._url("getBase64","Main","taoThemingPlatform"),method:"POST",data:{upload:result.uploaded_file},dataType:"json"}).done(function(response){response&&response.base64&&($(".logo").attr("src",response.base64),$(".icon-close").on("click",function(){$.ajax({url:helpers._url("getBase64","Main","taoThemingPlatform"),method:"POST",dataType:"json"}).done(function(response){response&&response.base64&&$(".logo").attr("src",response.base64)
})}))})}),$("#link").on("change",function(){$(".logo").closest("a").attr("href",$(this).val()),logoObject.link=$(this).val()}),$("#message").on("change",function(){$(".logo").closest("a").attr("title",$(this).val()),logoObject.message=$(this).val()}),$(".download-css").on("click",function(){$.ajax({url:helpers._url("download","Main","taoThemingPlatform"),method:"GET",dataType:"json"}).done(function(){})})},_initConfirmBox:function($popups,cssObject,logoObject){{var confirmBox=$(".confirm-modal-feedback"),cancel=confirmBox.find(".cancel"),save=confirmBox.find(".save");confirmBox.find(".modal-close")}confirmBox.modal({width:500}),save.off("click").on("click",function(){var isStable=$("#is-platform-stable").is(":checked"),loginMessage=$("#platform-login-message").val(),loginField=$("#platform-login-label").val(),passwordField=$("#platform-password-label").val(),copyrightNotice=$("#platform-copyright-notice").val();
$.ajax({url:helpers._url("saveTheme","Main","taoThemingPlatform")+"/",contentType:"application/x-www-form-urlencoded; charset=UTF-8",method:"POST",data:{css:cssObject,logo:logoObject,stable:isStable,login_msg:loginMessage,login_field:loginField,password_field:passwordField,copyright_notice:copyrightNotice},dataType:"json"}).done(function(response){response&&response.success?(feedback().success(response.message),$popups.not('[style="display: none;"]').hide()):feedback().error(response.message)}),confirmBox.modal("close")}),cancel.off("click").on("click",function(){confirmBox.modal("close")})},_initPopups:function($triggers,$popups,cssObject){var self=this;$triggers.on("click",function(e){var $elt=$(this),$popup=$($elt.data("popup")),$closer=$(".closer",$popup);
e.preventDefault(),e.stopPropagation(),$popups.not($popup).hide(),$(document).on("keyup",function(e){return 27===e.keyCode?($popup.hide(),!1):void 0}),$closer.on("click",function(){$popup.hide()});var $container=$(".color-picker",$popup);$container.each(function(){var $this=$(this),$input=$($this.find("input"));$this.on("colorchange.farbtastic",function(e,color){var type=$this.hasClass("background")?"background":"color",local=$elt.data("local")||$elt,target=$elt.data("target");$(local).each(function(){self._updatePreview($(this),color,type,cssObject)}),$input.val(color),color=$elt.data("important")?color+" !important":color;var name=$input.attr("name");cssObject[name]={selector:target,value:color}
}),self._initializeColorPicker($this,$input)}),$popup.show()})},_initUploader:function(){var $uploadContainer=$("#upload-stylesheet");$uploadContainer.on("upload.uploader",function(e,file,interactionHook){return interactionHook.error?void feedback().error(interactionHook.error):void feedback().success(interactionHook.success)}),$uploadContainer.on("fail.uploader",function(e,file,interactionHook){feedback().error(interactionHook.message)}),$uploadContainer.uploader({uploadUrl:$uploadContainer.data("url")})},_initializeColorPicker:function($container,input){var color=input.val(),widgetObj=$.farbtastic($container);widgetObj.setColor(color)},_updatePreview:function($container,color,type,cssObject){var oldStyle=$container.attr("style"),newStyle=oldStyle;
if("undefined"==typeof oldStyle)newStyle=type+":"+color+" !important";else if(-1===oldStyle.indexOf(type))newStyle=oldStyle+" "+type+":"+color+" !important";else{var patt=new RegExp(type+":[^;]+"),res=patt.exec(oldStyle);newStyle=oldStyle.replace(res,type+":"+color+" !important;")}if($container.attr("style",newStyle),"color"===type&&$container.hasClass("action-bar")){var calculatedColor=$container.css(type).replace("rgb","rgba").replace(")",",.3)");$container.find(".btn-info").css("border-color",calculatedColor),cssObject["action-border-color"]={selector:$container.data("calculus"),value:calculatedColor}}if("background"===type&&$container.hasClass("active")){var calculatedColor=$container.css(type).replace("rgb","rgba").replace(")",",.5)");
$("<style>.main-menu li a:hover{background:"+calculatedColor+" !important;}</style>").appendTo("head"),cssObject["hover-background"]={selector:$container.data("calculus"),value:calculatedColor}}}};return theming});
//# sourceMappingURL=routes.js
//# sourceMappingURL=routes.js.map