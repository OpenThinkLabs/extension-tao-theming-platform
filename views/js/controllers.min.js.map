{"version":3,"sources":["routes.js","../../lib/farbtastic/farbtastic.js","theming/main.js"],"names":["define","Main","actions","index","jQuery","$","fn","farbtastic","callback","this","container","length","get","_farbtastic","fb","e","class","colorObj","wheelObj","overlayObj","hMarkerObj","slMarkerObj","append","wheel","radius","square","width","linkTo","unbind","updateValue","color","bind","value","setColor","event","unpack","rgb","hsl","RGBToHSL","updateDisplay","setHSL","HSLToRGB","pack","widgetCoords","x","y","el","target","srcElement","reference","offsetX","pos","offsetY","mouseX","mouseY","offsetLeft","offsetTop","offsetParent","offset","undefined","absolutePosition","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","mousedown","document","dragging","mousemove","mouseup","circleDrag","Math","max","abs","hue","atan2","sat","min","lum","angle","css","left","round","sin","top","cos","backgroundColor","each","call","trigger","r","tmp","g","b","toString","parseInt","substring","m1","m2","h","s","l","hueToRGB","delta","helpers","feedback","uploader","theming","start","self","$scope","$triggers","find","$popups","cssObject","logoObject","_initUploader","_initPopups","off","on","_initConfirmBox","file","result","logo","ajax","url","_url","method","data","upload","uploaded_file","dataType","done","response","base64","attr","closest","val","link","message","confirmBox","cancel","save","modal","isStable","is","loginMessage","loginField","passwordField","copyrightNotice","contentType","stable","login_msg","login_field","password_field","copyright_notice","success","not","hide","error","$elt","$popup","$closer","preventDefault","stopPropagation","keyCode","$container","$this","$input","type","hasClass","local","_updatePreview","name","selector","_initializeColorPicker","show","$uploadContainer","interactionHook","uploadUrl","input","widgetObj","oldStyle","newStyle","indexOf","patt","RegExp","res","exec","replace","calculatedColor","appendTo"],"mappings":"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","file":"routes.js","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoThemingPlatform/controller/routes',[],function(){\n    'use strict';\n\n    return {\n        'Main' : {\n            'actions' : {\n                'index' : 'controller/theming/main'\n            }\n        }\n    };\n});\n\n","/**\n * Farbtastic Color Picker 1.2\n * © 2008 Steven Wittens\n *\n * This program is free software; you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation; either version 2 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n */\n\n/**\n * NOTE: THIS IS A MOD OF COLOR PICKER 1.2 - DO NOT UPGRADE!\n * 2014-03-06  dieter@taotesting.com\n */\ndefine('lib/farbtastic/farbtastic',['jquery'], function(jQuery){\n    var $ = jQuery;\n\njQuery.fn.farbtastic = function(callback) {\n    $.farbtastic(this, callback);\n    return this;\n};\n\njQuery.farbtastic = function(container, callback) {\n    if (!container.length) return;\n    var container = $(container).get(0);\n    return container.farbtastic || (container.farbtastic = new jQuery._farbtastic(container, callback));\n}\n\njQuery._farbtastic = function(container, callback) {\n    // Store farbtastic object\n    var fb = this;\n\n    // Insert markup\n    var e = $('<div>', {\n        'class': 'farbtastic'\n    }),\n        colorObj = $('<div>', {\n            'class': 'color'\n        }),\n        wheelObj = $('<div>', {\n            'class': 'wheel'\n        }),\n        overlayObj = $('<div>', {\n            'class': 'overlay'\n        }),\n        hMarkerObj = $('<div>', {\n            'class': 'h-marker marker'\n        }),\n        slMarkerObj = $('<div>', {\n            'class': 'sl-marker marker'\n        });\n\n    container = $(container);\n\n    $(e).append(colorObj);\n    $(e).append(wheelObj);\n    $(e).append(overlayObj);\n    $(e).append(hMarkerObj);\n    $(e).append(slMarkerObj);\n\n    container.append(e);\n\n\n    fb.wheel = wheelObj.get(0);\n    // Dimensions\n    fb.radius = 70;\n    fb.square = overlayObj.width();\n    fb.width = e.width();\n\n\n    /**\n     * Link to the given element(s) or callback.\n     */\n    fb.linkTo = function(callback) {\n        // Unbind previous nodes\n        if (typeof fb.callback == 'object') {\n            $(fb.callback).unbind('keyup', fb.updateValue);\n        }\n\n        // Reset color\n        fb.color = null;\n\n        // Bind callback or elements\n        if (typeof callback == 'function') {\n            fb.callback = callback;\n        } else if (typeof callback == 'object' || typeof callback == 'string') {\n            fb.callback = $(callback);\n            fb.callback.bind('keyup', fb.updateValue);\n            if (fb.callback.get(0).value) {\n                fb.setColor(fb.callback.get(0).value);\n            }\n        }\n        return this;\n    };\n\n    fb.updateValue = function(event) {\n        if (this.value && this.value != fb.color) {\n            fb.setColor(this.value);\n        }\n    };\n\n    /**\n     * Change color with HTML syntax #123456\n     */\n    fb.setColor = function(color) {\n        var unpack = fb.unpack(color);\n        if (fb.color != color && unpack) {\n            fb.color = color;\n            fb.rgb = unpack;\n            fb.hsl = fb.RGBToHSL(fb.rgb);\n            fb.updateDisplay();\n        }\n        return this;\n    };\n\n\n    /**\n     * Change color with HSL triplet [0..1, 0..1, 0..1]\n     */\n    fb.setHSL = function(hsl) {\n        fb.hsl = hsl;\n        fb.rgb = fb.HSLToRGB(hsl);\n        fb.color = fb.pack(fb.rgb);\n        fb.updateDisplay();\n        return this;\n    }\n\n    /////////////////////////////////////////////////////\n\n    /**\n     * Retrieve the coordinates of the given event relative to the center\n     * of the widget.\n     */\n    fb.widgetCoords = function(event) {\n        var x, y;\n        var el = event.target || event.srcElement;\n        var reference = fb.wheel;\n\n        if (typeof event.offsetX != 'undefined') {\n            // Use offset coordinates and find common offsetParent\n            var pos = {\n                x: event.offsetX,\n                y: event.offsetY\n            };\n\n            // Send the coordinates upwards through the offsetParent chain.\n            var e = el;\n            while (e) {\n                e.mouseX = pos.x;\n                e.mouseY = pos.y;\n                pos.x += e.offsetLeft;\n                pos.y += e.offsetTop;\n                e = e.offsetParent;\n            }\n\n            // Look for the coordinates starting from the wheel widget.\n            var e = reference;\n            var offset = {\n                x: 0,\n                y: 0\n            }\n            while (e) {\n                if (typeof e.mouseX != 'undefined') {\n                    x = e.mouseX - offset.x;\n                    y = e.mouseY - offset.y;\n                    break;\n                }\n                offset.x += e.offsetLeft;\n                offset.y += e.offsetTop;\n                e = e.offsetParent;\n            }\n\n            // Reset stored coordinates\n            e = el;\n            while (e) {\n                e.mouseX = undefined;\n                e.mouseY = undefined;\n                e = e.offsetParent;\n            }\n        } else {\n            // Use absolute coordinates\n            var pos = fb.absolutePosition(reference);\n            x = (event.pageX || 0 * (event.clientX + $('html').get(0).scrollLeft)) - pos.x;\n            y = (event.pageY || 0 * (event.clientY + $('html').get(0).scrollTop)) - pos.y;\n        }\n        // Subtract distance to middle\n        return {\n            x: x - fb.width / 2,\n            y: y - fb.width / 2\n        };\n    }\n\n    /**\n     * Mousedown handler\n     */\n    fb.mousedown = function(event) {\n        // Capture mouse\n        if (!document.dragging) {\n            $(document).bind('mousemove', fb.mousemove).bind('mouseup', fb.mouseup);\n            document.dragging = true;\n        }\n\n        // Check which area is being dragged\n        var pos = fb.widgetCoords(event);\n        fb.circleDrag = Math.max(Math.abs(pos.x), Math.abs(pos.y)) * 2 > fb.square;\n\n        // Process\n        fb.mousemove(event);\n        return false;\n    }\n\n    /**\n     * Mousemove handler\n     */\n    fb.mousemove = function(event) {\n        // Get coordinates relative to color picker center\n        var pos = fb.widgetCoords(event);\n\n        // Set new HSL parameters\n        if (fb.circleDrag) {\n            var hue = Math.atan2(pos.x, -pos.y) / 6.28;\n            if (hue < 0) hue += 1;\n            fb.setHSL([hue, fb.hsl[1], fb.hsl[2]]);\n        } else {\n            var sat = Math.max(0, Math.min(1, -(pos.x / fb.square) + .5));\n            var lum = Math.max(0, Math.min(1, -(pos.y / fb.square) + .5));\n            fb.setHSL([fb.hsl[0], sat, lum]);\n        }\n        return false;\n    }\n\n    /**\n     * Mouseup handler\n     */\n    fb.mouseup = function() {\n        // Uncapture mouse\n        $(document).unbind('mousemove', fb.mousemove);\n        $(document).unbind('mouseup', fb.mouseup);\n        document.dragging = false;\n    }\n\n    /**\n     * Update the markers and styles\n     */\n    fb.updateDisplay = function() {\n        // Markers\n        var angle = fb.hsl[0] * 6.28;\n        $('.h-marker', e).css({\n            left: Math.round(Math.sin(angle) * fb.radius + fb.width / 2) + 'px',\n            top: Math.round(-Math.cos(angle) * fb.radius + fb.width / 2) + 'px'\n        });\n\n        $('.sl-marker', e).css({\n            left: Math.round(fb.square * (.5 - fb.hsl[1]) + fb.width / 2) + 'px',\n            top: Math.round(fb.square * (.5 - fb.hsl[2]) + fb.width / 2) + 'px'\n        });\n\n        // Saturation/Luminance gradient\n        $('.color', e).css('backgroundColor', fb.pack(fb.HSLToRGB([fb.hsl[0], 1, 0.5])));\n\n        // Linked elements or callback\n        if (typeof fb.callback == 'object') {\n            // Set background/foreground color\n            $(fb.callback).css({\n                backgroundColor: fb.color,\n                color: fb.hsl[2] > 0.5 ? '#000' : '#fff'\n            });\n\n            // Change linked value\n            $(fb.callback).each(function() {\n                if (this.value && this.value != fb.color) {\n                    this.value = fb.color;\n                }\n            });\n        } else if (typeof fb.callback == 'function') {\n            fb.callback.call(fb, fb.color);\n        }\n        // mod by dieter\n        container.trigger('colorchange.farbtastic', [fb.color]);\n    }\n\n    /**\n     * Get absolute position of element\n     */\n    fb.absolutePosition = function(el) {\n        var r = {\n            x: el.offsetLeft,\n            y: el.offsetTop\n        };\n        // Resolve relative to offsetParent\n        if (el.offsetParent) {\n            var tmp = fb.absolutePosition(el.offsetParent);\n            r.x += tmp.x;\n            r.y += tmp.y;\n        }\n        return r;\n    };\n\n    /* Various color utility functions */\n    fb.pack = function(rgb) {\n        var r = Math.round(rgb[0] * 255);\n        var g = Math.round(rgb[1] * 255);\n        var b = Math.round(rgb[2] * 255);\n        return '#' + (r < 16 ? '0' : '') + r.toString(16) +\n            (g < 16 ? '0' : '') + g.toString(16) +\n            (b < 16 ? '0' : '') + b.toString(16);\n    }\n\n    fb.unpack = function(color) {\n        if (color.length == 7) {\n            return [parseInt('0x' + color.substring(1, 3)) / 255,\n                parseInt('0x' + color.substring(3, 5)) / 255,\n                parseInt('0x' + color.substring(5, 7)) / 255];\n        } else if (color.length == 4) {\n            return [parseInt('0x' + color.substring(1, 2)) / 15,\n                parseInt('0x' + color.substring(2, 3)) / 15,\n                parseInt('0x' + color.substring(3, 4)) / 15];\n        }\n    }\n\n    fb.HSLToRGB = function(hsl) {\n        var m1, m2, r, g, b;\n        var h = hsl[0],\n            s = hsl[1],\n            l = hsl[2];\n        m2 = (l <= 0.5) ? l * (s + 1) : l + s - l * s;\n        m1 = l * 2 - m2;\n        return [this.hueToRGB(m1, m2, h + 0.33333),\n            this.hueToRGB(m1, m2, h),\n            this.hueToRGB(m1, m2, h - 0.33333)];\n    };\n\n    fb.hueToRGB = function(m1, m2, h) {\n        h = (h < 0) ? h + 1 : ((h > 1) ? h - 1 : h);\n        if (h * 6 < 1) return m1 + (m2 - m1) * h * 6;\n        if (h * 2 < 1) return m2;\n        if (h * 3 < 2) return m1 + (m2 - m1) * (0.66666 - h) * 6;\n        return m1;\n    };\n\n    fb.RGBToHSL = function(rgb) {\n        var min, max, delta, h, s, l;\n        var r = rgb[0],\n            g = rgb[1],\n            b = rgb[2];\n        min = Math.min(r, Math.min(g, b));\n        max = Math.max(r, Math.max(g, b));\n        delta = max - min;\n        l = (min + max) / 2;\n        s = 0;\n        if (l > 0 && l < 1) {\n            s = delta / (l < 0.5 ? (2 * l) : (2 - 2 * l));\n        }\n        h = 0;\n        if (delta > 0) {\n            if (max == r && max != g) h += (g - b) / delta;\n            if (max == g && max != b) h += (2 + (b - r) / delta);\n            if (max == b && max != r) h += (4 + (r - g) / delta);\n            h /= 6;\n        }\n        return [h, s, l];\n    }\n\n    // Install mousedown handler (the others are set on the document on-demand)\n    $('*', e).mousedown(fb.mousedown);\n\n    // Init color\n    fb.setColor('#123456');\n\n    // Set linked elements/callback\n    if (callback) {\n        fb.linkTo(callback);\n    }\n}\n});\n\n","define('taoThemingPlatform/controller/theming/main',[\n    'jquery',\n    'helpers',\n    'lib/farbtastic/farbtastic',\n    'ui/feedback',\n    'ui/uploader'\n],\n    function($, helpers, farbtastic, feedback, uploader){\n\n        var theming = {\n            start : function(){\n                var self = this;\n\n                var $scope = $('.platform-theme-selector');\n                var $triggers = $scope.find('.customizer-trigger');\n                var $popups = $scope.find('.customizer-popup');\n                var cssObject = {};\n                var logoObject = {};\n\n                self._initUploader();\n                self._initPopups($triggers,$popups, cssObject);\n\n                $('.save').off('click').on('click',function(){\n                    self._initConfirmBox($popups, cssObject, logoObject);\n                });\n\n\n                $('.file-uploader').on('upload.uploader',function(e, file,result){\n                    logoObject.logo = result;\n                    $.ajax({\n                        url: helpers._url('getBase64', 'Main', 'taoThemingPlatform'),\n                        method: \"POST\",\n                        data: {upload : result.uploaded_file},\n                        dataType: \"json\"\n                    }).done(function(response){\n                        if(response && response.base64){\n                            $('.logo').attr('src',response.base64);\n\n                            $('.icon-close').on('click',function(){\n                                $.ajax({\n                                    url: helpers._url('getBase64', 'Main', 'taoThemingPlatform'),\n                                    method: \"POST\",\n                                    dataType: \"json\"\n                                }).done(function(response){\n                                    if(response && response.base64){\n                                        $('.logo').attr('src',response.base64);\n                                    }\n                                });\n                            });\n                        }\n                    });\n                });\n\n                $('#link').on('change',function(){\n                    $('.logo').closest('a').attr('href', $(this).val());\n                    logoObject.link = $(this).val();\n                });\n\n                $('#message').on('change',function(){\n                    $('.logo').closest('a').attr('title', $(this).val());\n                    logoObject.message = $(this).val();\n                });\n\n\n                $('.download-css').on('click', function(){\n                    $.ajax({\n                        url: helpers._url('download', 'Main', 'taoThemingPlatform'),\n                        method: \"GET\",\n                        dataType: \"json\"\n                    }).done(function(response){\n\n                    });\n                });\n\n            },\n\n            _initConfirmBox : function($popups, cssObject, logoObject){\n                // prompt a confirmation lightbox and then delete the result\n                var confirmBox = $('.confirm-modal-feedback'),\n                    cancel = confirmBox.find('.cancel'),\n                    save = confirmBox.find('.save'),\n                    close = confirmBox.find('.modal-close');\n\n                confirmBox.modal({ width: 500 });\n\n                save.off('click')\n                    .on('click', function () {\n                        var isStable = $('#is-platform-stable').is(':checked');\n                        var loginMessage = $('#platform-login-message').val();\n                        var loginField = $('#platform-login-label').val();\n                        var passwordField = $('#platform-password-label').val();\n                        var copyrightNotice = $('#platform-copyright-notice').val();\n                        \n                        $.ajax({\n                            url: helpers._url('saveTheme', 'Main', 'taoThemingPlatform') + '/',\n                            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',\n                            method: \"POST\",\n                            data: {\"css\":cssObject, \"logo\":logoObject, \"stable\": isStable, \"login_msg\": loginMessage, \"login_field\": loginField, \"password_field\": passwordField, \"copyright_notice\": copyrightNotice},\n                            dataType: 'json'\n                        }).done(function(response){\n                            if(response && response.success){\n                                feedback().success(response.message);\n                                $popups.not('[style=\"display: none;\"]').hide();\n                            }\n                            else{\n                                feedback().error(response.message);\n                            }\n                        });\n                        confirmBox.modal('close');\n                    });\n\n                cancel.off('click')\n                    .on('click', function () {\n                        confirmBox.modal('close');\n                    });\n\n            },\n\n            _initPopups : function($triggers, $popups, cssObject){\n                var self = this;\n\n                $triggers.on('click', function(e) {\n                    var $elt = $(this),\n                        $popup = $($elt.data('popup')),\n                        $closer = $('.closer',$popup);\n\n                    e.preventDefault();\n                    e.stopPropagation();\n                    $popups.not($popup).hide();\n\n\n                    // close color picker on escape\n                    $(document).on('keyup', function(e){\n                        if (e.keyCode === 27) {\n                            $popup.hide();\n                            return false;\n                        }\n                    });\n                    // close color picker on closer click\n                    $closer.on('click', function(){\n                        $popup.hide();\n                    });\n\n                    var $container = $('.color-picker',$popup)\n\n                    $container.each(function(){\n                        var $this = $(this);\n                        var $input = $($this.find('input'))\n\n                        // event received from modified farbtastic\n                        $this.on('colorchange.farbtastic', function (e, color) {\n\n                            var type = ($this.hasClass('background')) ? 'background' : 'color';\n                            var local = $elt.data('local') || $elt;\n                            var target = $elt.data('target');\n\n                            $(local).each(function(){\n                                self._updatePreview($(this), color, type, cssObject);\n                            });\n                            $input.val(color);\n                            color = ($elt.data('important'))?color+' !important':color;\n\n                            var name = $input.attr('name');\n                            cssObject[name] = {selector:target, value:color};\n                        });\n                        self._initializeColorPicker($this, $input);\n\n                    });\n                    $popup.show();\n                });\n            },\n            _initUploader : function(){\n                var $uploadContainer = $('#upload-stylesheet');\n                $uploadContainer.on('upload.uploader', function (e, file, interactionHook) {\n                    if(interactionHook.error) {\n                        feedback().error(interactionHook.error);\n                        return;\n                    }\n\n                    feedback().success(interactionHook.success);\n                });\n\n                $uploadContainer.on('fail.uploader', function (e, file, interactionHook) {\n                    feedback().error(interactionHook.message);\n                });\n\n                $uploadContainer.uploader({\n                    uploadUrl: $uploadContainer.data('url')\n                });\n            },\n\n            _initializeColorPicker : function($container,input){\n                var color = input.val();\n                var widgetObj = $.farbtastic($container);\n                widgetObj.setColor(color);\n\n            },\n\n            _updatePreview : function($container,color,type, cssObject){\n\n                var oldStyle = $container.attr('style');\n                var newStyle = oldStyle;\n                if(typeof oldStyle === 'undefined'){\n                    newStyle = type+':'+color+' !important';\n                }\n                else if(oldStyle.indexOf(type) === -1){\n                    newStyle = oldStyle + ' ' + type+':'+color+' !important';\n                }\n                else{\n                    var patt = new RegExp(type+':[^;]+');\n                    var res = patt.exec(oldStyle);\n                    newStyle = oldStyle.replace(res, type+':'+color+' !important;');\n                }\n\n                $container.attr('style', newStyle);\n\n                if(type === 'color' && $container.hasClass('action-bar')){\n                    var calculatedColor = $container.css(type).replace('rgb', 'rgba').replace(')', ',.3)');\n                    $container.find('.btn-info').css('border-color', calculatedColor);\n                    cssObject['action-border-color'] = {selector:$container.data('calculus'), value:calculatedColor};\n                }\n\n                if(type === 'background' && $container.hasClass('active')){\n                    var calculatedColor = $container.css(type).replace('rgb', 'rgba').replace(')', ',.5)');\n                    $('<style>.main-menu li a:hover{background:'+calculatedColor+' !important;}</style>').appendTo('head');\n                    cssObject['hover-background'] = {selector:$container.data('calculus'), value:calculatedColor};\n                }\n\n            }\n        };\n\n        return theming;\n    });\n"]}